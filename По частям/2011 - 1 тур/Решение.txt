
Процедура КнопкаСформироватьНажатие(Кнопка)
	ТабДок=ЭлементыФормы.ТабДок;
	ТабДок.Очистить();
	
	Макет=ПолучитьМакет("Макет");
	
	Область=Макет.ПолучитьОбласть("Шапка");
	ТабДок.Вывести(Область);
	
	Запрос=Новый Запрос;
	Запрос.Текст=
	"ВЫБРАТЬ
	|	ЖурналПроводокОстатки.Субконто1 КАК Номенклатура,
	|	ЖурналПроводокОстатки.Субконто1.Код КАК Код,
	|	ЖурналПроводокОстатки.СуммаОстатокДт / ЖурналПроводокОстатки.КоличествоОстатокДт КАК Цена,
	|	ПОДСТРОКА(ЖурналПроводокОстатки.Субконто1.Код, 5, 3) КАК Артикул,
	|	1 КАК КоличествоАртикулов
	|ИЗ
	|	РегистрБухгалтерии.ЖурналПроводок.Остатки(&Дата, Счет = &Счет41, , ) КАК ЖурналПроводокОстатки
	|
	|УПОРЯДОЧИТЬ ПО
	|	ЖурналПроводокОстатки.Субконто1.Наименование";
	
	Запрос.УстановитьПараметр("Дата",КонецДня(Дата));
	Запрос.УстановитьПараметр("Счет41",ПланыСчетов.ПланСчетов.Товары);
		
	ТабЗапроса=Запрос.Выполнить().Выгрузить();
	ТабЗапроса.Колонки.Добавить("РазницаСоСледСтрокой");
	ТабЗапроса.Сортировать("Цена");
	
	ТабВрем=ТабЗапроса.Скопировать();
	ТабВрем.Свернуть("Артикул","КоличествоАртикулов");
	ТабВрем.Сортировать("Артикул");
		
	Для Каждого ТекСтркоа из ТабВрем Цикл
		Если ТекСтркоа.КоличествоАртикулов>1 Тогда
			Отбор=Новый Структура;
			Отбор.Вставить("Артикул", ТекСтркоа.Артикул);
			
			товар1="";
			товар2="";
			СтрокиПоиска=ТабЗапроса.НайтиСтроки(Отбор);
			МинРазница=строкиПоиска.Получить(0);
			МинРазница=МинРазница.цена;
			Для строк=0 По СтрокиПоиска.Количество()-2 цикл
				строка = СтрокиПоиска.Получить(строк);
				строка2= СтрокиПоиска.Получить(строк+1);
				разница= строка.цена - строка2.цена;
				строка.РазницаСоСледСтрокой = макс(разница,-разница);
				если строка.РазницаСоСледСтрокой < МинРазница Тогда
					МинРазница=строка.РазницаСоСледСтрокой;
					НомТовар1=строк;
					НомТовар2=строк+1;
				конецЕсли;		
			КонецЦикла;
			Товар1=СтрокиПоиска.Получить(НомТовар1);
			Товар2=СтрокиПоиска.Получить(НомТовар2);
			Область=Макет.ПолучитьОбласть("Строка");
			
			Область.Параметры.Код = Товар1.Код;
			Область.Параметры.Номенклатура = Товар1.Номенклатура;
			Область.Параметры.Цена = Товар1.Цена;
			Область.Параметры.Код2 = Товар2.Код;
			Область.Параметры.Номенклатура2 = Товар2.Номенклатура;
			Область.Параметры.Цена2 = Товар2.Цена;
			ТабДок.Вывести(Область);
			//сообщить (сокрлп(товар1)+" "+сокрлп(товар2));
			
		КонецЕсли;
	КонецЦикла;
	
	ТабДок.ТолькоПросмотр=Истина;
	
КонецПроцедуры

Процедура ПередОткрытием(Отказ, СтандартнаяОбработка)
	Дата=ТекущаяДата();
КонецПроцедуры
